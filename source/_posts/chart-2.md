title: iOS报表技术（二）
date: 2015-02-01 20:44:10
tags:
---

这周我们讲讲如何使用层模型来绘图，和绘画家模型（Canvas）不同，绘画家的图是静态的，所以只要安排好画每一笔的顺序就好了
每一笔都叠在已画好的上面，画布只有一层

![](/img/jack.png)

CALayer 的层模型更进一步，把不同图层的对象区分开来，这样就有了更加灵活的和可复用的绘图手法

![](/img/jack-layers1.png)

我们的报表也采用这种模型，从最底到最上我们就可以区分出这么几层

* 背景层
* BAND层
* 轴，包括装饰用的
	* 轴标注
* 渐变填充层
	* 完整渐变
	* 渐变遮罩层
* 线层
	* 正常线
	* 超出范围的线
		* 完整的线
		* 范围遮罩层
* 点层
* 标注层

![曲线](/img/chart-1.png)

我们就用了这样 7个主图层，7个辅助图层，最终描出了所需的报表，图层之间大多是（半）透明，因此会产生图层的混合运算，这是由GPU完成的，可以不担心性能，当然，关闭其中不必要的透明图层可以提高性能。


有同学可能对一条线能够在不同范围表现出不同的色彩感到很惊奇，觉得没法用画布画出来，其实不然，人的视觉是带有惯性的，所以不能以这种思维去思考问题，我们在计算机层面上很容易理解这个问题，首先画出一条红线，然后再画一条白线，把范围外的白线都切掉，然后叠在红线上，不就形成了所需要的效果吗？ 不需要你一口气去画出红白相间的线的。

在层模型上，剪切就可以用层遮罩代替，所以上面可以看到两个遮罩层，是用来裁剪所需范围的图层的。

今天就到这里，下次继续~！
